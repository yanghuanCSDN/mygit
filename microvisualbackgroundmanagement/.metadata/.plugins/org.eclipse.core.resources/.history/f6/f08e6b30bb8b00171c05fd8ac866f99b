package com.yanghuan.dao;

import java.sql.Date;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

import com.yanghuan.dbmanager.DbManager;
import com.yanghuan.model.User;

public class BackwardManagementDao {
	DbManager	dbManager=new DbManager();
	//查询所有用户信息
	public List<User> getAll(){
		String sql="select personid, qqnumber, personsignature, realname," +
				" 	idcard, cellphonenumber, judgeopened, submissiontime " +
				"	from userinfo";
		ResultSet	set=dbManager.executeQuary(sql);
		List<User> userinfos=new GetList().getList(set);
		return	userinfos;
	}
	//查询已开通公众空间用户信息
	public List<User> getAllDredge(){
		String sql="select personid, qqnumber, personsignature, realname," +
				" 	idcard, cellphonenumber, judgeopened, submissiontime " +
				"	from userinfo  where JudgeOpened=0";
		ResultSet	set=dbManager.executeQuary(sql);
		List<User> userinfos=new GetList().getList(set);
		return	userinfos;
	}
	//查询未开通公众空间用户信息
	public List<User> getAllNotDredge(){
		String sql="select personid, qqnumber, personsignature, realname," +
				" 	idcard, cellphonenumber, judgeopened, submissiontime " +
				"	from userinfo  where JudgeOpened=1";
		ResultSet	set=dbManager.executeQuary(sql);
		List<User> userinfos=new GetList().getList(set);
		return	userinfos;
	}
	//通过qqnumber查询申请用户信息
	public User getUserinfoByQQ(String qqnumber){
		String sql="select personid, qqnumber, personsignature, realname," +
				" 	idcard, cellphonenumber, judgeopened, submissiontime " +
				"	from userinfo  where qqnumber=?";
		ResultSet	set=dbManager.executeQuary(sql, qqnumber);
		try {
			User user=new User(
					set.getInt("personid"),
					set.getString("qqnumber"),
					set.getString("personsignature"),
					set.getString("realname"), 
					set.getString("idcard"),
					set.getString("cellphonenumber"), 
					set.getInt("judgeopened"),
					set.getDate("submissiontime")
					);
			return user;
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		return null;
	}
	//通过submissiontime查询申请用户信息
		public User getUserinfoByTime(Date submissiontime){
			String sql="select personid, qqnumber, personsignature, realname," +
					" 	idcard, cellphonenumber, judgeopened, submissiontime " +
					"	from userinfo  where submissiontime=?";
			int count=dbManager.executeUpdate(sql,submissiontime);
			if(count==1){
				return true;
			}
				return false;
		}
	//申请是否开通公众空间
	public Boolean ApplicationPublicSpace(int judgeopenedint,Date date1,int id,Date date){
		String sql="update userinfo" +
					" set judgeopened = ?," +
					" submissiontime =?" +
					" where personid = ?  or submissiontime=?";
		int	count=dbManager.executeUpdate(sql,judgeopenedint,date1,id,date);
		if(count==1){
			return true;
		}
			return false;
	}
}
	

